<page-wrapper>
<div class="history-container">
  <h2 class="title">ğŸ“œ Dream History</h2>

  <div class="columns">
    <!-- Left column: Dreams -->
    <div class="column">
      <h3>ğŸ›Œ Dreams</h3>
      <div *ngFor="let dream of (showAllDreams ? dreams : dreams.slice(0, 3))" class="card">
        <div *ngIf="editingId === dream.id">
          <textarea [(ngModel)]="dream.editText" rows="2"></textarea>
          <textarea [(ngModel)]="dream.interpretationEdit" rows="3"></textarea>
          <div class="buttons">
            <button (click)="saveEdit(dream)">ğŸ’¾ Save</button>
            <button (click)="cancelEdit()">âŒ Cancel</button>
          </div>
        </div>
        <div *ngIf="editingId !== dream.id">
          <p><strong>Dream:</strong> {{ dream.dream }}</p>
          <p><strong>Interpretation:</strong> {{ dream.interpretation }}</p>
          <p><strong>Emotion:</strong> {{ dream.emotion }} <span class="emoji"><strong>{{ dream.emoji }}</strong></span></p>
          <div class="buttons">
            <button (click)="startEdit(dream)">âœï¸ Edit</button>
            <button (click)="deleteDream(dream.id)">ğŸ—‘ï¸ Delete</button>
          </div>
        </div>
      </div>
      <button *ngIf="dreams.length > 3" (click)="showAllDreams = !showAllDreams">
        {{ showAllDreams ? 'ğŸ”½ Collapse Dreams' : 'ğŸ” View All Dreams' }}
      </button>
    </div>

    <!-- Right column: Follow-ups -->
    <div class="column">
      <h3>ğŸ§  Follow-Up Answers</h3>
      <div *ngFor="let group of groupedFollowups" class="followup-group">
        <h4>ğŸ•’ {{ group.timestamp }}</h4>

        <div *ngFor="let f of group.followups" class="followup-card">

          <div *ngIf="editingFollowupId !== f.id">
            <p><strong>Q:</strong> {{ f.question }}</p>
            <p><strong>A:</strong> {{ f.answer }}</p>
            <div class="buttons">
              <button (click)="startEditFollowup(f)">âœï¸ Edit</button>
              <button (click)="deleteFollowup(f)">ğŸ—‘ï¸ Delete</button>
            </div>
          </div>
          <div *ngIf="editingFollowupId === f.id">
            <p><strong>Q:</strong> {{ f.question }}</p>
            <textarea [(ngModel)]="editedFollowups[f.id]" rows="2"></textarea>
            <div class="buttons">
              <button (click)="saveFollowupEdit(f)">ğŸ’¾ Save</button>
              <button (click)="cancelEditFollowup()">âŒ Cancel</button>
            </div>
          </div>
        </div>
      </div>
      <button *ngIf="followups.length > 3" (click)="showAllFollowups = !showAllFollowups">
        {{ showAllFollowups ? 'ğŸ”½ Collapse Follow-Ups' : 'ğŸ” View All Follow-Ups' }}
      </button>
    </div>
  </div>
</div>
</page-wrapper>